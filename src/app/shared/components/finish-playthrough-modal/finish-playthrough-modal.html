<div class="overlay" (click)="close()"></div>

<div class="modal">
  <h2>Finalizar partida</h2>

  <form (ngSubmit)="onSubmit()" novalidate>
    <!-- Fecha -->
    <label>
      Fecha de finalización
      <input #dateInput type="text" required />
    </label>

    <!-- Horas -->
    <label>
      Horas jugadas
      <div class="number-wrapper">
        <input type="number" min="0" [(ngModel)]="hours" name="hours" #hoursInput />
        <div class="spinner">
          <div class="arrow up" (click)="increment(hoursInput)"></div>
          <div class="arrow down" (click)="decrement(hoursInput)"></div>
        </div>
      </div>
    </label>

    <!-- Checkboxes -->
    <div class="checkbox-group">
      <label>
        <input
          type="checkbox"
          [(ngModel)]="completed"
          name="completed"
          (change)="onCompletedChange()"
        />
        Historia completada
      </label>

      <label>
        <input
          type="checkbox"
          [(ngModel)]="platinum"
          name="platinum"
          (change)="onPlatinumChange()"
          [disabled]="!completed"
        />
        Platino conseguido
      </label>
    </div>

    <!-- Notas -->
    <label>
      Notas (opcional)
      <textarea
        [(ngModel)]="notes"
        name="notes"
        rows="3"
        placeholder="Ej: NG+, comenzado con 10h..."
      ></textarea>
    </label>

    <!-- Error -->
    @if (errorMessage) {
      <p class="error">{{ errorMessage }}</p>
    }

    <!-- Acciones -->
    <div class="actions">
      <button type="button" class="cancel" (click)="close()">Cancelar</button>

      <button type="submit" [disabled]="isLoading" class="submit-btn">
        <span class="btn-content" [class.hidden]="isLoading"> Finalizar </span>

        @if (isLoading) {
          <span class="btn-spinner"></span>
        }
      </button>
    </div>
  </form>
</div>

@if (showConfirmModal) {
  <app-confirm-modal
    title="Finalizar partida"
    message="¿Seguro que quieres finalizar esta partida? Se marcará como completada."
    confirmText="Finalizar"
    cancelText="Cancelar"
    (confirm)="confirmFinish()"
    (cancel)="close()"
  />
}
