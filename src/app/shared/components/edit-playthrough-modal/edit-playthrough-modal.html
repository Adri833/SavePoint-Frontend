<div class="overlay" (click)="close()"></div>

<div class="modal">
  <h2>Editar partida</h2>

  <form (ngSubmit)="updatePlaythrough()" novalidate>
    <!-- Fecha inicio -->
    <label>
      Fecha de inicio
      <input #dateInput type="text" required />
    </label>

    <!-- Fecha fin (solo si existe) -->
    @if (playthrough.ended_at) {
      <label>
        Fecha de fin
        <input #endDateInput type="text" required />
      </label>
    }

    @if (!isPlaying) {
      <!-- Horas -->
      <label>
        Horas jugadas
        <div class="number-wrapper">
          <input type="number" min="0" [(ngModel)]="hours" name="hours" #hoursInput />
          <div class="spinner">
            <div class="arrow up" (click)="increment(hoursInput)"></div>
            <div class="arrow down" (click)="decrement(hoursInput)"></div>
          </div>
        </div>
      </label>

      <!-- Checkboxes -->
      <div class="checkbox-group">
        <label>
          <input
            type="checkbox"
            [(ngModel)]="completed"
            name="completed"
            (change)="onCompletedChange()"
          />
          Historia completada
        </label>

        <label>
          <input
            type="checkbox"
            [(ngModel)]="platinum"
            name="platinum"
            (change)="onPlatinumChange()"
            [disabled]="!completed"
          />
          Platino conseguido
        </label>
      </div>
    }

    <!-- Notas -->
    <label>
      Notas
      <textarea [(ngModel)]="notes" name="notes" rows="3"></textarea>
    </label>

    @if (errorMessage) {
      <p class="error">{{ errorMessage }}</p>
    }

    <div class="actions">
      <!-- Papelera -->
      <button
        type="button"
        class="delete-btn"
        [class.confirming]="confirmingDelete"
        [disabled]="isLoading"
        (click)="onDeleteClick()"
      >
        @if (confirmingDelete) {
          Â¿Borrar?
        } @else {
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
            <path d="M10 11v6M14 11v6" />
            <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
          </svg>
        }
      </button>

      <div class="right-actions">
        <button type="button" class="cancel" (click)="close()">Cancelar</button>

        <button type="submit" [disabled]="isLoading">
          <span class="btn-content" [class.hidden]="isLoading">Guardar</span>
          @if (isLoading) {
            <span class="btn-spinner"></span>
          }
        </button>
      </div>
    </div>
  </form>
</div>
